{{- /*
Renders a menu for the given menu ID.

@context {page} page The current page.
@context {string} menuID The menu ID.

@example: {{ partial "menu.html" (dict "menuID" "main" "page" .) }}
*/}}

{{ $page := . }}
{{ $menuID := "main" }}

{{ with index site.Menus $menuID }}
  <div class="main-menu">
    {{ partial "inline/menu/walk.html" (dict "page" $page "menuEntries" .) }}
  </div>
{{ end }}

{{ define "_partials/inline/menu/walk.html" }}
  {{ $page := .page }}
  {{ $entries := .menuEntries }}
  {{ $lastIndex := sub (len $entries) 1 }}
  {{ range $i, $entry := $entries }}
    {{ $name := .Name }}
    {{ with .Identifier }}
      {{ with T . }}
        {{ $name = . }}
      {{ end }}
    {{ end }}
    {{ $pageRef := .PageRef }}
    {{/* TODO: look for a better approach to handle links */}}
    {{ $url := print "/" $page.Language.Lang $pageRef "/" }} {{/* This is not a clean solution */}}
    {{ if eq $url $page.RelPermalink }}
      <span class="active">
        {{ $name }}
      </span>
    {{ else }}
      <span class="inactive">
        <a href="{{ $url }}">{{ $name }}</a>
      </span>
    {{ end }}
    {{ if lt $i $lastIndex }}
      <span>&middot;</span>
    {{ end }}
    {{ with .Children }}
      {{ partial "inline/menu/walk.html" (dict "page" $page "menuEntries" .) }} {{/* Recursion */}}
    {{ end }}
  {{ end }}
{{ end }}
